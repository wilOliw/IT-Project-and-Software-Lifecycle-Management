# Elegant Studio — Документация проекта

## Описание проекта

**Elegant Studio** — это веб-приложение для салона красоты, разработанное на Django 4.2.7. Система позволяет клиентам записываться на услуги, просматривать портфолио мастеров и оставлять отзывы. Администраторы могут управлять услугами, мастерами и записями через административную панель.

---

## Инструкция по запуску

### Требования

- **Python 3.10+** (рекомендуется 3.11 или 3.12)
- **pip** (менеджер пакетов Python)
- **Git** (опционально, для клонирования)

---

### Windows

#### Способ 1: Автоматический запуск (рекомендуется)

1. Откройте папку проекта в проводнике
2. Дважды кликните на файл `start.bat`
3. Дождитесь завершения установки
4. Браузер откроется автоматически на `http://127.0.0.1:8000/`

#### Способ 2: Ручной запуск

```powershell
# 1. Откройте PowerShell или CMD в папке проекта

# 2. Создайте виртуальное окружение (рекомендуется)
python -m venv venv
venv\Scripts\activate

# 3. Установите зависимости
pip install -r requirements-dev.txt

# 4. Выполните миграции базы данных
python manage.py migrate

# 5. Создайте суперпользователя
python manage.py createsuperuser

# 6. Соберите статические файлы
python manage.py collectstatic --noinput

# 7. Запустите сервер
python manage.py runserver
```

---

### macOS

```bash
# 1. Откройте Terminal и перейдите в папку проекта
cd /путь/к/проекту/app

# 2. Создайте виртуальное окружение
python3 -m venv venv
source venv/bin/activate

# 3. Установите зависимости
pip install -r requirements-dev.txt

# 4. Выполните миграции базы данных
python manage.py migrate

# 5. Создайте суперпользователя
python manage.py createsuperuser
# Введите: логин, email, пароль (дважды)

# 6. Соберите статические файлы
python manage.py collectstatic --noinput

# 7. Запустите сервер разработки
python manage.py runserver
```

#### Создание скрипта автозапуска для macOS

Создайте файл `start.sh`:

```bash
#!/bin/bash
cd "$(dirname "$0")"

echo "Запуск Elegant Studio..."

# Активация виртуального окружения
if [ -d "venv" ]; then
    source venv/bin/activate
else
    python3 -m venv venv
    source venv/bin/activate
    pip install -r requirements-dev.txt
fi

# Миграции и запуск
python manage.py migrate
python manage.py collectstatic --noinput
python manage.py runserver
```

Сделайте исполняемым: `chmod +x start.sh`

---

### Данные для входа (после автозапуска)

| Параметр | Значение |
|----------|----------|
| Сайт | http://127.0.0.1:8000/ |
| Админ-панель | http://127.0.0.1:8000/admin/ |
| Логин | admin |
| Пароль | admin123 |

---

## Архитектура и модули

### Структура проекта

```
app/
├── elegant_studio/     # Конфигурация Django-проекта
│   ├── settings.py     # Настройки приложения
│   ├── urls.py         # Главный роутер URL
│   └── wsgi.py         # Точка входа для продакшена
│
├── core/               # Основной модуль
├── services/           # Модуль услуг
├── masters/            # Модуль мастеров
├── bookings/           # Модуль записей
├── portfolio/          # Модуль портфолио
├── reviews/            # Модуль отзывов
│
├── templates/          # HTML-шаблоны
├── static/             # Статические файлы (CSS, JS, изображения)
├── media/              # Загруженные файлы пользователей
├── db.sqlite3          # База данных SQLite
└── manage.py           # Утилита управления Django
```

---

### Модуль `core` — Основной функционал

**Назначение:** Главная страница, информация о салоне, контакты, новости, профили пользователей.

**Модели:**
- `UserProfile` — Расширенный профиль пользователя (телефон, дата рождения, адрес)
- `Contact` — Контактная информация салона
- `News` — Новости и акции
- `About` — Разделы "О салоне"

**URL-маршруты:**

| URL | Описание |
|-----|----------|
| `/` | Главная страница |
| `/about/` | О салоне |
| `/contacts/` | Контакты |
| `/news/` | Список новостей |
| `/news/<id>/` | Детали новости |
| `/profile/` | Профиль пользователя |
| `/search/` | Поиск по сайту |
| `/accounts/login/` | Вход |
| `/accounts/logout/` | Выход |
| `/accounts/signup/` | Регистрация |

---

### Модуль `services` — Услуги

**Назначение:** Каталог услуг салона с категориями и ценами.

**Модели:**
- `Category` — Категории услуг (стрижки, маникюр и т.д.)
- `Service` — Услуга (название, описание, цена, длительность)

**URL-маршруты:**

| URL | Описание |
|-----|----------|
| `/services/` | Каталог услуг с фильтрацией |
| `/services/<id>/` | Детали услуги |
| `/services/category/<id>/` | Услуги по категории |
| `/services/price/` | Прайс-лист |

**Возможности фильтрации:**
- По категории
- По диапазону цен
- По длительности
- Сортировка (цена, название, популярность)

---

### Модуль `masters` — Мастера

**Назначение:** Профили специалистов салона с расписанием и специализацией.

**Модели:**
- `Master` — Профиль мастера (связан с User, специализация, опыт, фото)
- `MasterService` — Связь мастер-услуга с индивидуальными ценами/длительностью
- `MasterSchedule` — Расписание работы по дням недели

**URL-маршруты:**

| URL | Описание |
|-----|----------|
| `/masters/` | Список мастеров |
| `/masters/<id>/` | Профиль мастера с расписанием |
| `/masters/service/<id>/` | Мастера, оказывающие услугу |

---

### Модуль `bookings` — Записи на приём

**Назначение:** Онлайн-запись клиентов с проверкой доступности времени.

**Модели:**
- `Appointment` — Запись (клиент, мастер, услуга, дата, время, статус)
- `TimeSlot` — Доступные временные слоты

**Статусы записи:**
- `pending` — Ожидает подтверждения
- `confirmed` — Подтверждена
- `completed` — Завершена
- `cancelled` — Отменена
- `no_show` — Неявка

**URL-маршруты:**

| URL | Описание |
|-----|----------|
| `/bookings/` | Мои записи |
| `/bookings/create/` | Создать запись |
| `/bookings/<id>/` | Детали записи |
| `/bookings/<id>/edit/` | Редактировать запись |
| `/bookings/<id>/cancel/` | Отменить запись |
| `/bookings/available-times/` | API доступного времени (JSON) |
| `/bookings/admin/` | Управление записями (для персонала) |

**Рабочие часы:** 9:00 — 21:00

---

### Модуль `portfolio` — Портфолио

**Назначение:** Галерея работ мастеров.

**Модели:**
- `Portfolio` — Работа (мастер, услуга, описание, главное фото)
- `PortfolioImage` — Дополнительные изображения работы

**URL-маршруты:**

| URL | Описание |
|-----|----------|
| `/portfolio/` | Все работы |
| `/portfolio/featured/` | Избранные работы |
| `/portfolio/<id>/` | Детали работы |
| `/portfolio/master/<id>/` | Портфолио мастера |
| `/portfolio/service/<id>/` | Работы по услуге |

---

### Модуль `reviews` — Отзывы

**Назначение:** Система отзывов и рейтингов с возможностью ответа мастера.

**Модели:**
- `Review` — Отзыв (автор, мастер, услуга, рейтинг 1-5, текст, проверен)
- `ReviewImage` — Фото к отзыву
- `ReviewResponse` — Ответ мастера на отзыв

**URL-маршруты:**

| URL | Описание |
|-----|----------|
| `/reviews/` | Все отзывы со статистикой |
| `/reviews/create/` | Написать отзыв |
| `/reviews/<id>/` | Детали отзыва |
| `/reviews/<id>/edit/` | Редактировать отзыв |
| `/reviews/<id>/delete/` | Удалить отзыв |
| `/reviews/<id>/response/` | Ответить на отзыв (мастер) |
| `/reviews/master/<id>/` | Отзывы о мастере |
| `/reviews/service/<id>/` | Отзывы об услуге |
| `/reviews/stats/` | Статистика отзывов |

---

## Бизнес-логика

### Процесс записи на приём

```
1. Клиент регистрируется/входит в систему
2. Выбирает услугу из каталога
3. Выбирает мастера, оказывающего услугу
4. Система показывает доступные даты/время (с учётом расписания мастера)
5. Клиент выбирает время
6. Система проверяет отсутствие конфликтов
7. Создаётся запись со статусом "pending"
8. Администратор подтверждает запись
9. После оказания услуги статус меняется на "completed"
10. Клиент может оставить отзыв
```

### Расчёт доступного времени

- Учитывается расписание мастера (`MasterSchedule`)
- Проверяются существующие записи на выбранную дату
- Учитывается длительность услуги
- Время автоматически рассчитывается с 9:00 до 21:00

### Система рейтингов

- Средний рейтинг мастера = сумма оценок / количество отзывов
- Отзывы могут быть помечены как "проверенные"
- Мастер может ответить на отзыв один раз
- Статистика показывает распределение оценок (1-5 звёзд)

### Права доступа

| Роль | Возможности |
|------|-------------|
| Гость | Просмотр услуг, мастеров, портфолио, отзывов |
| Клиент | + Запись на приём, отзывы, профиль |
| Мастер (staff) | + Ответы на отзывы, своё портфолио |
| Администратор | + Полный доступ к админ-панели |

---

## Схема базы данных

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│    User     │────>│ UserProfile │     │  Category   │
└──────┬──────┘     └─────────────┘     └──────┬──────┘
       │                                       │
       v                                       v
┌─────────────┐     ┌───────────────┐   ┌─────────────┐
│   Master    │<───>│ MasterService │<─>│   Service   │
└──────┬──────┘     └───────────────┘   └──────┬──────┘
       │                                       │
       ├──────────────────┬────────────────────┤
       v                  v                    v
┌─────────────┐   ┌─────────────┐      ┌─────────────┐
│ Appointment │   │  Portfolio  │      │   Review    │
└─────────────┘   └──────┬──────┘      └──────┬──────┘
                         │                    │
                         v                    v
                  ┌──────────────┐    ┌──────────────┐
                  │PortfolioImage│    │ReviewResponse│
                  └──────────────┘    └──────────────┘
```

---

## Полезная информация

### Технологический стек

| Компонент | Технология |
|-----------|------------|
| Backend | Django 4.2.7, Python 3.x |
| База данных | SQLite3 (dev) / PostgreSQL (prod) |
| Frontend | Bootstrap 5, Django Templates |
| Формы | django-crispy-forms + Bootstrap5 |
| Изображения | Pillow |
| Статика | WhiteNoise |
| Сервер | Gunicorn (production) |

### Переменные окружения (.env)

```env
SECRET_KEY=django-insecure-change-me-in-production
DEBUG=True
ALLOWED_HOSTS=localhost,127.0.0.1
DB_NAME=elegant_studio
DB_USER=postgres
DB_PASSWORD=your_password
DB_HOST=localhost
DB_PORT=5432
EMAIL_BACKEND=django.core.mail.backends.console.EmailBackend
```

### Полезные команды Django

```bash
# Создание миграций после изменения моделей
python manage.py makemigrations

# Применение миграций
python manage.py migrate

# Создание суперпользователя
python manage.py createsuperuser

# Запуск интерактивной консоли Django
python manage.py shell

# Сбор статических файлов
python manage.py collectstatic

# Проверка проекта на ошибки
python manage.py check

# Просмотр SQL для миграции
python manage.py sqlmigrate <app_name> <migration_number>
```

### Настройки для продакшена

1. Измените `DEBUG=False` в `.env`
2. Укажите реальный `SECRET_KEY`
3. Настройте `ALLOWED_HOSTS`
4. Переключитесь на PostgreSQL
5. Настройте HTTPS (SSL)
6. Используйте Gunicorn + Nginx

### Локализация

- Язык интерфейса: Русский (`ru-ru`)
- Часовой пояс: Москва (`Europe/Moscow`)

### Административная панель

Доступ: `/admin/`

Доступные разделы:
- Пользователи и профили
- Категории и услуги
- Мастера и расписания
- Записи на приём
- Портфолио
- Отзывы
- Новости и контакты

---

## Возможные проблемы и решения

| Проблема | Решение |
|----------|---------|
| "Python не найден" | Установите Python с python.org, добавьте в PATH |
| Ошибка миграций | Удалите `db.sqlite3` и папки `migrations`, выполните `makemigrations` и `migrate` |
| Статика не загружается | Выполните `python manage.py collectstatic` |
| Порт 8000 занят | Используйте `python manage.py runserver 8080` |
| Ошибка Pillow | Установите: `pip install Pillow --upgrade` |
